global:
  resolve_timeout: 5m
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: '123456 @gmail.com'
  smtp_auth_username: '123456@gmail.com'
  smtp_auth_password: 'abcdefghijklmnopq'
  smtp_require_tls: true

# è·¯ç”±é…ç½®
route:
  group_by: ['alertname', 'cluster', 'severity']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'email-notifications'
  
  routes:
    # Critical å‘Šè­¦ç«‹å³ç™¼é€
    - match:
        severity: critical
      receiver: 'email-critical'
      group_wait: 0s
      repeat_interval: 4h
    
    # Warning å‘Šè­¦æ‰¹æ¬¡ç™¼é€
    - match:
        severity: warning
      receiver: 'email-warnings'
      group_wait: 30s
      repeat_interval: 24h

# æ¥æ”¶å™¨é…ç½®
receivers:
  # ä¸€èˆ¬é€šçŸ¥
  - name: 'email-notifications'
    email_configs:
      - to: 'kylin@aishield.com.tw'
        headers:
          Subject: '[Monitoring] {{ .GroupLabels.alertname }}'
        html: |
          <!DOCTYPE html>
          <html>
          <body>
            <h2>ğŸš¨ Alert Notification</h2>
            <table border="1" cellpadding="5">
              <tr><th>Alert</th><td>{{ .GroupLabels.alertname }}</td></tr>
              <tr><th>Severity</th><td>{{ .CommonLabels.severity }}</td></tr>
              <tr><th>Summary</th><td>{{ .CommonAnnotations.summary }}</td></tr>
              <tr><th>Description</th><td>{{ .CommonAnnotations.description }}</td></tr>
              <tr><th>Time</th><td>{{ .StartsAt }}</td></tr>
            </table>
          </body>
          </html>

  # Critical å‘Šè­¦
  - name: 'email-critical'
    email_configs:
      - to: 'kylin@aishield.com.tw'
        headers:
          Subject: 'ğŸ”´ [CRITICAL] {{ .GroupLabels.alertname }}'
        html: |
          <!DOCTYPE html>
          <html>
          <body style="background-color: #ffe6e6;">
            <h1 style="color: red;">ğŸ”´ CRITICAL ALERT</h1>
            <table border="2" cellpadding="10" style="border-color: red;">
              <tr><th>Alert</th><td><strong>{{ .GroupLabels.alertname }}</strong></td></tr>
              <tr><th>Summary</th><td>{{ .CommonAnnotations.summary }}</td></tr>
              <tr><th>Description</th><td>{{ .CommonAnnotations.description }}</td></tr>
              <tr><th>Started At</th><td>{{ .StartsAt }}</td></tr>
            </table>
            <p style="color: red; font-weight: bold;">è«‹ç«‹å³è™•ç†æ­¤å‘Šè­¦ï¼</p>
          </body>
          </html>

  # Warning å‘Šè­¦
  - name: 'email-warnings'
    email_configs:
      - to: 'kylin@aishield.com.tw'
        headers:
          Subject: 'âš ï¸  [WARNING] {{ .GroupLabels.alertname }}'

# æŠ‘åˆ¶è¦å‰‡ï¼ˆé¿å…é‡è¤‡å‘Šè­¦ï¼‰
inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'cluster']
